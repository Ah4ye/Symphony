{% extends 'Layouts/layout_vente.html.twig' %}

{% block title %}{{ parent() }} : magasins{% endblock %}

{% block titre_principal %}{{ parent() }} : produits dans une fourchette de prix{% endblock %}

{% block vue %}
    {# normalement devrait être dans un fichier css #}
    <style>
        caption { border: red solid 1px; }
        table { border: black solid 1px; }
        th, td { border: black solid 1px; padding: 2px 10px 2px 10px;}
        th { text-align: right; }
    </style>

    <span style="font-weight: bold; font-size: 20px ">Vos differents Magasin :</span>
    <nav aria-label="Page navigation example">
        <ul class="pagination">
    {% for pages in page %}
            <li class="page-item"><a class="page-link" href="{{ path('magasin_stock', {'id': pages.id }) }}">{{ pages.id }}</a></li>
    {% endfor %}
        </ul>
    </nav>
        Nous sommes dans le magasin numéro&nbsp;{{ id }}.<br />
        <a class="btn btn-info" href="{{ path('magasin_valeur_stock', {'id': id }) }}">Voir la Valeur des stocks de tout les magasins</a><br />
        Voici la liste des produits dont les prix sont compris entre {{ valinf }}&nbsp;euro{{ valinf <=1 ? '' : 's' }}
        et
        {% if valsup == -1 %}
            pas de limite.
        {% else %}
            {{ valsup }}&nbsp;euro{{ valsup <=1 ? '' : 's' }}.
        {% endif %}
    </p>

    {% set quantite = 0 %}
    {% set total = 0 %}

    {% if app.request.method == 'POST' %}
        {% set id = id %}
        {% set valinf = app.request.request.get('valinf') %}
        {% set valsup = app.request.request.get('valsup') %}

        {% set url = path('magasin_stock', {'id': id, 'valinf': valinf, 'valsup': valsup}) %}

        <script>
            window.location.href = "{{ url }}";
        </script>
    {% endif %}
    <p>Appliquer un filtre</p>
    <form method="post">
        Entre
        <input type="number" name="valinf" placeholder="Valeur minimale" min="0" value="{{ valinf | default(0) }}" style="width: 100px;">
        ET
        <input type="number" name="valsup" placeholder="Valeur maximale" pattern="[1-9]\d*" value="{{ valinf+1 | default(100000) }}" style="width: 100px;">
        <button type="submit"class="btn btn-dark">Filter</button>
    </form>
    <br />
    <table>
        <caption>Produit(s) correspondant à vos critères</caption>
        <tr>
            <th>dénomination</th>
            <th>PU</th>
            <th>qté</th>
            <th>total</th>
            <th>Edit</th>
        </tr>

        {% for produit in produits %}
            {# Notez au passage les deux manières d'accéder à une case du tableau produit :
                produit['denomination']      la plus logique car produit est un tableau
                produit.denomination         la plus lisible (et que nous utiliserons)
            #}
            {% if (produit.prixUnitaire >= valinf) and ((valsup == -1) or (produit.prixUnitaire <= valsup)) %}
                {% set totalProduit = produit.quantite * produit.prixUnitaire %}
                {% set quantite = quantite + produit.quantite %}
                {% set total = total + totalProduit %}
                <tr>
                    <td>{{ produit.denomination }}</td>
                    <td>{{ produit.prixUnitaire }}</td>
                    <td>{{ produit.quantite }}</td>
                    <td>{{ totalProduit }}</td>
                      {% set urlEdit = path('magasin_edit', {'idProduit' : produit.id,'idMagasin': id}) %}
                    <td><a href="{{ urlEdit }}" class="btn btn-primary">Edit</a></td>
                </tr>
            {% endif %}
        {% endfor %}
        <tr>
            <th colspan="2">totaux</th>
            <td>{{ quantite }}</td>
            <td>{{ total }}</td>
        </tr>
    </table>
{% endblock %}
